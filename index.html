<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>StoicFX VIP Concierge</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --red: #E8392A;
            --red-glow: rgba(232, 57, 42, 0.22);
            --red-dim: rgba(232, 57, 42, 0.10);
            --bg: #080a0c;
            --surface: #111317;
            --surface-2: #191c22;
            --surface-3: #1e2128;
            --border: rgba(255,255,255,0.06);
            --border-hover: rgba(255,255,255,0.1);
            --border-active: rgba(232,57,42,0.55);
            --text: #e8eaef;
            --text-sub: #8a8f9e;
            --text-hint: #3e4452;
            --success: #2dd36f;
            --success-dim: rgba(45,211,111,0.12);
            --radius: 12px;
        }

        html { height: 100%; }
        body {
            min-height: 100%;
            background: var(--bg);
            background-image:
                radial-gradient(ellipse 70% 45% at 100% -5%, rgba(232,57,42,0.07) 0%, transparent 55%),
                radial-gradient(ellipse 40% 40% at 0% 100%, rgba(232,57,42,0.04) 0%, transparent 60%);
            color: var(--text);
            font-family: 'Outfit', sans-serif;
            -webkit-font-smoothing: antialiased;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 18px 14px 44px;
        }

        .card {
            width: 100%;
            max-width: 400px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 18px;
            overflow: hidden;
            box-shadow: 0 0 0 1px rgba(255,255,255,0.025), 0 32px 64px rgba(0,0,0,0.6), 0 4px 16px rgba(0,0,0,0.4);
            animation: rise 0.55s cubic-bezier(0.16, 1, 0.3, 1) both;
        }
        @keyframes rise { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .card-top-bar { height: 3px; background: linear-gradient(90deg, var(--red) 0%, rgba(232,57,42,0.3) 100%); }

        .header { padding: 22px 24px 20px; border-bottom: 1px solid var(--border); }

        .brand-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .brand-logo img { height: 22px; width: auto; display: block; opacity: 0.92; }

        .vip-pill { display: flex; align-items: center; gap: 6px; background: var(--red-dim); border: 1px solid rgba(232,57,42,0.2); border-radius: 20px; padding: 4px 10px 4px 8px; }
        .vip-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--red); box-shadow: 0 0 5px var(--red); animation: blink 2.5s ease-in-out infinite; }
        @keyframes blink { 0%,100%{opacity:1;} 50%{opacity:0.35;} }
        .vip-text { font-size: 10px; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; color: var(--red); }

        .header-title { font-family: 'Cormorant Garamond', serif; font-size: 34px; font-weight: 700; line-height: 1.08; letter-spacing: -0.3px; color: var(--text); margin-bottom: 6px; }
        .header-title em { font-style: italic; color: var(--red); }
        .header-sub { font-size: 12.5px; color: var(--text-sub); font-weight: 300; line-height: 1.55; }

        .ref-row { display: flex; align-items: center; gap: 10px; margin-top: 16px; padding: 10px 13px; background: var(--surface-2); border: 1px solid var(--border); border-radius: 8px; }
        .ref-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--success); box-shadow: 0 0 7px var(--success); flex-shrink: 0; animation: pulse-dot 2.2s ease-in-out infinite; }
        @keyframes pulse-dot { 0%, 100% { opacity: 1; box-shadow: 0 0 7px var(--success); } 50% { opacity: 0.35; box-shadow: none; } }
        .ref-label { font-size: 11px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: var(--text-sub); }
        .ref-value { margin-left: auto; font-size: 12px; font-weight: 700; color: var(--text-sub); letter-spacing: 0.5px; font-variant-numeric: tabular-nums; }

        /* ‚îÄ‚îÄ FORM ‚îÄ‚îÄ */
        .form-body { padding: 20px 24px 24px; }

        .field { margin-bottom: 18px; }

        .field-label-row { display: flex; align-items: baseline; justify-content: space-between; margin-bottom: 7px; }
        label { font-size: 10.5px; font-weight: 700; letter-spacing: 1.1px; text-transform: uppercase; color: var(--text-sub); }
        .field-tag { font-size: 10px; color: var(--text-hint); font-weight: 400; letter-spacing: 0; font-style: italic; }

        .input-wrap { position: relative; }
        .input-icon { position: absolute; left: 13px; top: 50%; transform: translateY(-50%); font-size: 13px; opacity: 0.3; pointer-events: none; transition: opacity 0.2s; line-height: 1; }
        input, select, textarea {
            width: 100%;
            padding: 12px 13px 12px 38px;
            background: var(--surface-2);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text);
            font-family: 'Outfit', sans-serif;
            font-size: 15px;
            font-weight: 400;
            transition: border-color 0.18s, box-shadow 0.18s, background 0.18s;
            -webkit-appearance: none;
        }
        select { padding-left: 38px; cursor: pointer; }
        select option { background: #1e2128; color: var(--text); }
        textarea { padding: 12px 13px; resize: none; min-height: 90px; line-height: 1.5; }
        input::placeholder, textarea::placeholder { color: var(--text-hint); }
        .input-wrap:focus-within .input-icon { opacity: 0.65; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--border-active); background: var(--surface-3); box-shadow: 0 0 0 3px var(--red-dim); }
        input.valid { border-color: rgba(45,211,111,0.35); }
        input.error, select.error { border-color: rgba(232,57,42,0.5); }
        .field-error { font-size: 11px; color: rgba(232,57,42,0.85); margin-top: 5px; padding-left: 2px; display: none; }

        /* No-icon inputs */
        .no-icon { padding-left: 14px !important; }

        /* ‚îÄ‚îÄ SECTION LABEL ‚îÄ‚îÄ */
        .section-label { display: flex; align-items: center; gap: 8px; margin: 22px 0 14px; }
        .section-label-line { flex: 1; height: 1px; background: var(--border); }
        .section-label-text { font-size: 10px; font-weight: 700; letter-spacing: 1.3px; text-transform: uppercase; color: var(--text-hint); }

        /* ‚îÄ‚îÄ PLAN CARDS (IB Move) ‚îÄ‚îÄ */
        .plan-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .plan-card { position: relative; background: var(--surface-2); border: 1px solid var(--border); border-radius: 10px; padding: 14px 8px 12px; cursor: pointer; text-align: center; transition: border-color 0.18s, background 0.18s, transform 0.12s; -webkit-tap-highlight-color: transparent; user-select: none; }
        .plan-card:active { transform: scale(0.96); }
        .plan-card:hover:not(.selected) { border-color: var(--border-hover); background: var(--surface-3); }
        .plan-card.selected { border-color: var(--red); background: linear-gradient(135deg, rgba(232,57,42,0.12) 0%, rgba(232,57,42,0.06) 100%); }
        .plan-check { position: absolute; top: 6px; right: 6px; width: 15px; height: 15px; border-radius: 50%; background: var(--red); display: flex; align-items: center; justify-content: center; font-size: 8px; color: white; font-weight: 700; opacity: 0; transform: scale(0.4); transition: all 0.22s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .plan-card.selected .plan-check { opacity: 1; transform: scale(1); }
        .plan-icon { font-size: 20px; margin-bottom: 5px; line-height: 1; }
        .plan-name { font-size: 11.5px; font-weight: 700; color: var(--text-sub); letter-spacing: 0.3px; }
        .plan-card.selected .plan-name { color: var(--text); }
        .plan-card.plan-other { grid-column: 1 / -1; display: flex; align-items: center; gap: 12px; padding: 12px 14px; text-align: left; }
        .plan-card.plan-other .plan-icon { font-size: 17px; margin-bottom: 0; flex-shrink: 0; }
        .plan-card.plan-other .plan-name { margin: 0; }
        .plan-err { font-size: 11px; color: rgba(232,57,42,0.85); margin-top: 8px; display: none; }

        .other-input-wrap { overflow: hidden; max-height: 0; opacity: 0; transform: translateY(-6px); transition: max-height 0.32s cubic-bezier(0.16,1,0.3,1), opacity 0.22s ease, transform 0.22s ease; pointer-events: none; margin-top: 0; }
        .other-input-wrap.visible { max-height: 70px; opacity: 1; transform: translateY(0); pointer-events: auto; margin-top: 10px; }

        /* ‚îÄ‚îÄ METHOD CHIPS (Deposit/Withdrawal) ‚îÄ‚îÄ */
        .method-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
        .method-card { position: relative; background: var(--surface-2); border: 1px solid var(--border); border-radius: 10px; padding: 12px 10px 10px; cursor: pointer; text-align: center; transition: border-color 0.18s, background 0.18s, transform 0.12s; -webkit-tap-highlight-color: transparent; user-select: none; }
        .method-card:active { transform: scale(0.96); }
        .method-card:hover:not(.selected) { border-color: var(--border-hover); background: var(--surface-3); }
        .method-card.selected { border-color: var(--red); background: linear-gradient(135deg, rgba(232,57,42,0.12) 0%, rgba(232,57,42,0.06) 100%); }
        .method-check { position: absolute; top: 6px; right: 6px; width: 14px; height: 14px; border-radius: 50%; background: var(--red); display: flex; align-items: center; justify-content: center; font-size: 7px; color: white; font-weight: 700; opacity: 0; transform: scale(0.4); transition: all 0.22s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .method-card.selected .method-check { opacity: 1; transform: scale(1); }
        .method-icon { font-size: 18px; margin-bottom: 4px; line-height: 1; }
        .method-name { font-size: 11px; font-weight: 700; color: var(--text-sub); letter-spacing: 0.2px; }
        .method-card.selected .method-name { color: var(--text); }
        .method-err { font-size: 11px; color: rgba(232,57,42,0.85); margin-top: 8px; display: none; }

        /* ‚îÄ‚îÄ DESTINATION TOGGLE ‚îÄ‚îÄ */
        .dest-toggle { display: grid; grid-template-columns: 1fr 1fr; gap: 0; background: var(--surface-2); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
        .dest-option { padding: 11px 8px; text-align: center; cursor: pointer; font-size: 12px; font-weight: 600; color: var(--text-sub); transition: background 0.18s, color 0.18s; user-select: none; -webkit-tap-highlight-color: transparent; }
        .dest-option:first-child { border-right: 1px solid var(--border); }
        .dest-option.selected { background: linear-gradient(135deg, rgba(232,57,42,0.15), rgba(232,57,42,0.08)); color: var(--text); }
        .dest-err { font-size: 11px; color: rgba(232,57,42,0.85); margin-top: 5px; display: none; }

        /* ‚îÄ‚îÄ SUBMIT ‚îÄ‚îÄ */
        .submit-rule { height: 1px; background: var(--border); margin: 26px 0 24px; }
        #submit-btn { width: 100%; padding: 17px 20px; background: var(--red); color: white; border: none; border-radius: var(--radius); font-family: 'Outfit', sans-serif; font-size: 15px; font-weight: 700; letter-spacing: 0.4px; cursor: pointer; position: relative; overflow: hidden; box-shadow: 0 4px 20px var(--red-glow), 0 1px 0 rgba(255,255,255,0.1) inset; transition: transform 0.14s, box-shadow 0.18s, opacity 0.2s; }
        #submit-btn::after { content: ''; position: absolute; inset: 0; background: linear-gradient(180deg, rgba(255,255,255,0.1) 0%, transparent 60%); pointer-events: none; }
        #submit-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 10px 28px rgba(232,57,42,0.45); }
        #submit-btn:active:not(:disabled) { transform: scale(0.98); opacity: 0.88; }
        #submit-btn:disabled { opacity: 0.45; cursor: not-allowed; box-shadow: none; transform: none; }
        .btn-inner { display: flex; align-items: center; justify-content: center; gap: 8px; }
        .spinner { width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3); border-top-color: #fff; border-radius: 50%; animation: spin 0.65s linear infinite; display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .btn-arrow { transition: transform 0.18s; }
        #submit-btn:hover:not(:disabled) .btn-arrow { transform: translateX(4px); }

        .disclaimer { text-align: center; font-size: 10.5px; color: var(--text-hint); margin-top: 14px; line-height: 1.5; }

        /* ‚îÄ‚îÄ SUCCESS ‚îÄ‚îÄ */
        .success-state { display: none; flex-direction: column; align-items: center; padding: 40px 24px 44px; text-align: center; }
        .success-check-wrap { position: relative; width: 72px; height: 72px; margin-bottom: 28px; }
        .success-ring-svg { position: absolute; inset: 0; transform: rotate(-90deg); }
        .success-ring-track { fill: none; stroke: rgba(45,211,111,0.12); stroke-width: 2; }
        .success-ring-fill { fill: none; stroke: var(--success); stroke-width: 2; stroke-linecap: round; stroke-dasharray: 207; stroke-dashoffset: 207; animation: draw-ring 0.65s cubic-bezier(0.4, 0, 0.2, 1) forwards 0.15s; }
        @keyframes draw-ring { to { stroke-dashoffset: 0; } }
        .success-check-icon { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: var(--success-dim); border-radius: 50%; margin: 8px; font-size: 22px; opacity: 0; transform: scale(0.5); animation: pop-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards 0.55s; }
        @keyframes pop-in { to { opacity: 1; transform: scale(1); } }
        .success-label { font-size: 10px; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; color: var(--success); opacity: 0; transform: translateY(6px); animation: fade-up 0.4s ease forwards 0.75s; margin-bottom: 10px; }
        .success-title { font-family: 'Cormorant Garamond', serif; font-size: 30px; font-weight: 700; color: var(--text); letter-spacing: -0.3px; line-height: 1.1; opacity: 0; transform: translateY(8px); animation: fade-up 0.4s ease forwards 0.85s; margin-bottom: 10px; }
        .success-body { font-size: 13px; color: var(--text-sub); line-height: 1.6; max-width: 270px; font-weight: 300; opacity: 0; transform: translateY(8px); animation: fade-up 0.4s ease forwards 0.95s; }
        @keyframes fade-up { to { opacity: 1; transform: translateY(0); } }
        .success-divider { width: 40px; height: 1px; background: var(--border); margin: 22px auto 0; opacity: 0; animation: fade-up 0.4s ease forwards 1.05s; }
        .success-ref-chip { display: inline-flex; align-items: center; gap: 10px; margin-top: 14px; padding: 9px 16px; background: var(--surface-2); border: 1px solid var(--border); border-radius: 20px; opacity: 0; transform: translateY(6px); animation: fade-up 0.4s ease forwards 1.1s; }
        .success-ref-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-hint); font-weight: 700; }
        .success-ref-divider { width: 1px; height: 12px; background: var(--border); }
        .success-ref-val { font-size: 12.5px; color: var(--success); font-weight: 700; letter-spacing: 0.5px; }
        .success-closing { font-size: 11px; color: var(--text-hint); margin-top: 20px; opacity: 0; animation: fade-up 0.4s ease forwards 1.25s; }

        @media (prefers-reduced-motion: reduce) { *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; } }
    </style>
</head>
<body>
<div class="card">
    <div class="card-top-bar"></div>

    <!-- HEADER -->
    <div class="header">
        <div class="brand-row">
            <div class="brand-logo">
                <img src="data:image/png;base64,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" alt="StoicFX">
            </div>
            <div class="vip-pill">
                <div class="vip-dot"></div>
                <span class="vip-text">Concierge</span>
            </div>
        </div>

        <div class="header-title" id="header-title">Loading‚Ä¶</div>
        <div class="header-sub" id="header-sub"></div>

        <div class="ref-row">
            <div class="ref-dot"></div>
            <span class="ref-label">Session Active</span>
            <span class="ref-value"><span style="opacity:0.45;font-weight:400;letter-spacing:0.5px">REF&nbsp;</span><span id="ref-display">‚Äî</span></span>
        </div>
    </div>

    <!-- FORM STATE -->
    <div class="form-body" id="form-state">
        <div id="form-fields"></div>

        <div class="submit-rule"></div>
        <div class="submit-wrap">
            <button id="submit-btn" disabled onclick="sendData()">
                <div class="btn-inner">
                    <div class="spinner" id="spinner"></div>
                    <span id="btn-label">Submit Request</span>
                    <span class="btn-arrow" id="btn-arrow" style="display:none">‚Üó</span>
                </div>
            </button>
        </div>
        <div class="disclaimer">Requests are reviewed and processed by our team.</div>
    </div>

    <!-- SUCCESS STATE -->
    <div class="success-state" id="success-state">
        <div class="success-check-wrap">
            <svg class="success-ring-svg" viewBox="0 0 72 72">
                <circle class="success-ring-track" cx="36" cy="36" r="33"/>
                <circle class="success-ring-fill" cx="36" cy="36" r="33"/>
            </svg>
            <div class="success-check-icon">‚úì</div>
        </div>
        <div class="success-label">Request Confirmed</div>
        <div class="success-title" id="success-title">Submitted</div>
        <div class="success-body">Your request has been logged and our team has been notified.</div>
        <div class="success-divider"></div>
        <div class="success-ref-chip">
            <span class="success-ref-label">Reference</span>
            <div class="success-ref-divider"></div>
            <span class="success-ref-val" id="success-ref-val">‚Äî</span>
        </div>
        <div class="success-closing">This window will close automatically.</div>
    </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ Telegram init
const tg = window.Telegram?.WebApp;
if (tg) { tg.expand(); tg.setHeaderColor?.("#111317"); tg.ready?.(); }

// ‚îÄ‚îÄ‚îÄ URL params
const urlParams = new URLSearchParams(window.location.search);
const ref = urlParams.get("ref") || String(Math.floor(100000 + Math.random() * 900000));
const category = urlParams.get("category") || "ib_move";

document.getElementById("ref-display").textContent = ref;
document.getElementById("success-ref-val").textContent = ref;

// ‚îÄ‚îÄ‚îÄ Webhook URLs per category
const WEBHOOKS = {
    ib_move:    "https://stoicfx.app.n8n.cloud/webhook/82d3a4a1-1978-4820-a27f-4378ba21f6f0",
    deposit:    "https://stoicfx.app.n8n.cloud/webhook/DEPOSIT_WEBHOOK_ID",
    withdrawal: "https://stoicfx.app.n8n.cloud/webhook/WITHDRAWAL_WEBHOOK_ID",
    trading:    "https://stoicfx.app.n8n.cloud/webhook/TRADING_WEBHOOK_ID"
};

// ‚îÄ‚îÄ‚îÄ Category config
const CATEGORY_CONFIG = {
    ib_move: {
        title: 'IB <em>Move</em><br>Request',
        sub: 'Assign a client trader to your partner network under a selected commission structure.',
        success: 'IB Move<br>Submitted'
    },
    deposit: {
        title: '<em>Deposit</em><br>Request',
        sub: 'Submit a deposit request for a client trading account.',
        success: 'Deposit<br>Submitted'
    },
    withdrawal: {
        title: '<em>Withdrawal</em><br>Request',
        sub: 'Submit a withdrawal request from a client trading account.',
        success: 'Withdrawal<br>Submitted'
    },
    trading: {
        title: '<em>Trading</em><br>Request',
        sub: 'Submit a trading assistance request for a client account.',
        success: 'Trading Request<br>Submitted'
    }
};

const config = CATEGORY_CONFIG[category] || CATEGORY_CONFIG.ib_move;
document.getElementById("header-title").innerHTML = config.title;
document.getElementById("header-sub").textContent = config.sub;
document.getElementById("success-title").innerHTML = config.success;

// ‚îÄ‚îÄ‚îÄ Validation helpers
const emailRx = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

function validateEmail(inputId, errId) {
    const el = document.getElementById(inputId);
    const err = document.getElementById(errId);
    const v = el.value.trim();
    const isValid = !!v && emailRx.test(v);
    el.classList.toggle("valid", isValid);
    el.classList.toggle("error", !!v && !isValid);
    err.style.display = (!!v && !isValid) ? "block" : "none";
    return isValid;
}

function setError(errId, msg, show) {
    const el = document.getElementById(errId);
    if (el) { el.textContent = msg || el.textContent; el.style.display = show ? "block" : "none"; }
}

// ‚îÄ‚îÄ‚îÄ Form state
let selectedPlan = "";
let selectedMethod = "";
let selectedDestination = "";

// ‚îÄ‚îÄ‚îÄ Render forms
function renderForm() {
    const container = document.getElementById("form-fields");

    if (category === "ib_move") {
        container.innerHTML = `
        <div class="field">
            <div class="field-label-row"><label for="ib_email">IB Partner Email</label><span class="field-tag">Receiving partner</span></div>
            <div class="input-wrap"><span class="input-icon">‚úâ</span><input type="email" id="ib_email" placeholder="partner@domain.com" autocomplete="email" autocapitalize="none" inputmode="email"></div>
            <div class="field-error" id="ib_err">Enter a valid email address.</div>
        </div>
        <div class="field">
            <div class="field-label-row"><label for="client_email">Client Email</label><span class="field-tag">Trader being moved</span></div>
            <div class="input-wrap"><span class="input-icon">‚úâ</span><input type="email" id="client_email" placeholder="client@domain.com" autocomplete="email" autocapitalize="none" inputmode="email"></div>
            <div class="field-error" id="client_err">Enter a valid email address.</div>
        </div>
        <div class="section-label"><div class="section-label-line"></div><span class="section-label-text">Commission Structure</span><div class="section-label-line"></div></div>
        <div class="plan-grid">
            <div class="plan-card" data-plan="Apex" onclick="selectPlan(this)"><div class="plan-check">‚úì</div><div class="plan-icon">üèîÔ∏è</div><div class="plan-name">Apex</div></div>
            <div class="plan-card" data-plan="Kleos" onclick="selectPlan(this)"><div class="plan-check">‚úì</div><div class="plan-icon">‚ö°</div><div class="plan-name">Kleos</div></div>
            <div class="plan-card" data-plan="Acropolis" onclick="selectPlan(this)"><div class="plan-check">‚úì</div><div class="plan-icon">üèõÔ∏è</div><div class="plan-name">Acropolis</div></div>
            <div class="plan-card plan-other" data-plan="Other" onclick="selectPlan(this)"><div class="plan-check">‚úì</div><div class="plan-icon">‚úèÔ∏è</div><div class="plan-name">Other ‚Äî specify below</div></div>
        </div>
        <div class="other-input-wrap" id="other-input-wrap">
            <input type="text" id="other_plan_input" class="no-icon" placeholder="Describe the plan or structure‚Ä¶" maxlength="80" autocomplete="off">
        </div>
        <div class="plan-err" id="plan_err">Please select a commission plan.</div>`;

        document.getElementById("ib_email").addEventListener("input", () => { validateEmail("ib_email","ib_err"); checkReady(); });
        document.getElementById("client_email").addEventListener("input", () => { validateEmail("client_email","client_err"); checkReady(); });
        document.getElementById("other_plan_input").addEventListener("input", checkReady);
    }

    else if (category === "deposit") {
        container.innerHTML = `
        <div class="field">
            <div class="field-label-row"><label for="account_number">Account Number</label><span class="field-tag">Client trading account</span></div>
            <div class="input-wrap"><span class="input-icon">#</span><input type="text" id="account_number" placeholder="e.g. 1234567" autocomplete="off" inputmode="numeric"></div>
            <div class="field-error" id="account_err">Please enter the account number.</div>
        </div>
        <div class="field">
            <div class="field-label-row"><label for="amount">Amount</label><span class="field-tag">USD equivalent</span></div>
            <div class="input-wrap"><span class="input-icon">$</span><input type="text" id="amount" placeholder="e.g. 1000" autocomplete="off" inputmode="decimal"></div>
            <div class="field-error" id="amount_err">Please enter the deposit amount.</div>
        </div>
        <div class="section-label"><div class="section-label-line"></div><span class="section-label-text">Payment Method</span><div class="section-label-line"></div></div>
        <div class="method-grid">
            <div class="method-card" data-method="Crypto (BTC)" onclick="selectMethod(this)"><div class="method-check">‚úì</div><div class="method-icon">‚Çø</div><div class="method-name">Bitcoin</div></div>
            <div class="method-card" data-method="Crypto (ETH)" onclick="selectMethod(this)"><div class="method-check">‚úì</div><div class="method-icon">Œû</div><div class="method-name">Ethereum</div></div>
            <div class="method-card" data-method="Crypto (USDT)" onclick="selectMethod(this)"><div class="method-check">‚úì</div><div class="method-icon">‚ÇÆ</div><div class="method-name">USDT</div></div>
            <div class="method-card" data-method="Crypto (BNB)" onclick="selectMethod(this)"><div class="method-check">‚úì</div><div class="method-icon">üî∂</div><div class="method-name">BNB</div></div>
            <div class="method-card" data-method="SticPay" onclick="selectMethod(this)"><div class="method-check">‚úì</div><div class="method-icon">üí≥</div><div class="method-name">SticPay</div></div>
            <div class="method-card" data-method="Skrill" onclick="selectMethod(this)"><div class="method-check">‚úì</div><div class="method-icon">üíú</div><div class="method-name">Skrill</div></div>
            <div class="method-card" data-method="Visa/MC" onclick="selectMethod(this)"><div class="method-check">‚úì</div><div class="method-icon">üí≥</div><div class="method-name">Visa / MC</div></div>
            <div class="method-card" data-method="Amex/GPay" onclick="selectMethod(this)"><div class="method-check">‚úì</div><div class="method-icon">üí≥</div><div class="method-name">Amex / GPay</div></div>
        </div>
        <div class="method-err" id="method_err">Please select a payment method.</div>
        <div class="section-label"><div class="section-label-line"></div><span class="section-label-text">Destination</span><div class="section-label-line"></div></div>
        <div class="dest-toggle">
            <div class="dest-option" data-dest="Trading Account" onclick="selectDest(this)">Trading Account</div>
            <div class="dest-option" data-dest="Client Wallet" onclick="selectDest(this)">Client Wallet</div>
        </div>
        <div class="dest-err" id="dest_err">Please select a destination.</div>`;

        document.getElementById("account_number").addEventListener("input", checkReady);
        document.getElementById("amount").addEventListener("input", checkReady);
    }

    else if (category === "withdrawal") {
        container.innerHTML = `
        <div class="field">
            <div class="field-label-row"><label for="account_number">Account Number</label><span class="field-tag">Client trading account</span></div>
            <div class="input-wrap"><span class="input-icon">#</span><input type="text" id="account_number" placeholder="e.g. 1234567" autocomplete="off" inputmode="numeric"></div>
            <div class="field-error" id="account_err">Please enter the account number.</div>
        </div>
        <div class="field">
            <div class="field-label-row"><label for="amount">Amount</label><span class="field-tag">USD equivalent</span></div>
            <div class="input-wrap"><span class="input-icon">$</span><input type="text" id="amount" placeholder="e.g. 500" autocomplete="off" inputmode="decimal"></div>
            <div class="field-error" id="amount_err">Please enter the withdrawal amount.</div>
        </div>
        <div class="field">
            <div class="field-label-row"><label for="destination_details">Destination Details</label><span class="field-tag">Wallet address or account</span></div>
            <div class="input-wrap"><textarea id="destination_details" class="no-icon" placeholder="Wallet address, bank details, or account reference‚Ä¶" style="padding-left:14px"></textarea></div>
            <div class="field-error" id="dest_details_err">Please provide destination details.</div>
        </div>
        <div class="section-label"><div class="section-label-line"></div><span class="section-label-text">Withdrawal Method</span><div class="section-label-line"></div></div>
        <div class="method-grid">
            <div class="method-card" data-method="Crypto (BTC)" onclick="selectMethod(this)"><div class="method-check">‚úì</div><div class="method-icon">‚Çø</div><div class="method-name">Bitcoin</div></div>
            <div class="method-card" data-method="Crypto (ETH)" onclick="selectMethod(this)"><div class="method-check">‚úì</div><div class="method-icon">Œû</div><div class="method-name">Ethereum</div></div>
            <div class="method-card" data-method="Crypto (USDT)" onclick="selectMethod(this)"><div class="method-check">‚úì</div><div class="method-icon">‚ÇÆ</div><div class="method-name">USDT</div></div>
            <div class="method-card" data-method="Crypto (BNB)" onclick="selectMethod(this)"><div class="method-check">‚úì</div><div class="method-icon">üî∂</div><div class="method-name">BNB</div></div>
            <div class="method-card" data-method="SticPay" onclick="selectMethod(this)"><div class="method-check">‚úì</div><div class="method-icon">üí≥</div><div class="method-name">SticPay</div></div>
            <div class="method-card" data-method="Skrill" onclick="selectMethod(this)"><div class="method-check">‚úì</div><div class="method-icon">üíú</div><div class="method-name">Skrill</div></div>
        </div>
        <div class="method-err" id="method_err">Please select a withdrawal method.</div>`;

        document.getElementById("account_number").addEventListener("input", checkReady);
        document.getElementById("amount").addEventListener("input", checkReady);
        document.getElementById("destination_details").addEventListener("input", checkReady);
    }

    else if (category === "trading") {
        container.innerHTML = `
        <div class="field">
            <div class="field-label-row"><label for="account_number">Account Number</label><span class="field-tag">Client trading account</span></div>
            <div class="input-wrap"><span class="input-icon">#</span><input type="text" id="account_number" placeholder="e.g. 1234567" autocomplete="off" inputmode="numeric"></div>
            <div class="field-error" id="account_err">Please enter the account number.</div>
        </div>
        <div class="field">
            <div class="field-label-row"><label for="request_type">Request Type</label></div>
            <div class="input-wrap"><span class="input-icon">üìã</span>
            <select id="request_type">
                <option value="" disabled selected>Select request type‚Ä¶</option>
                <option value="Open Position">Open Position</option>
                <option value="Close Position">Close Position</option>
                <option value="Modify SL/TP">Modify SL / TP</option>
                <option value="Account Leverage">Account Leverage</option>
                <option value="Other">Other</option>
            </select></div>
            <div class="field-error" id="type_err">Please select a request type.</div>
        </div>
        <div class="field">
            <div class="field-label-row"><label for="details">Request Details</label><span class="field-tag">Be specific</span></div>
            <textarea id="details" class="no-icon" placeholder="Describe the trade or action required, including instrument, size, direction or any other relevant details‚Ä¶" style="padding-left:14px; min-height:110px"></textarea>
            <div class="field-error" id="details_err">Please provide request details.</div>
        </div>`;

        document.getElementById("account_number").addEventListener("input", checkReady);
        document.getElementById("request_type").addEventListener("change", checkReady);
        document.getElementById("details").addEventListener("input", checkReady);
    }
}

// ‚îÄ‚îÄ‚îÄ Plan selection (IB Move)
function selectPlan(el) {
    document.querySelectorAll(".plan-card").forEach(c => c.classList.remove("selected"));
    el.classList.add("selected");
    selectedPlan = el.dataset.plan;
    setError("plan_err", null, false);
    const otherWrap = document.getElementById("other-input-wrap");
    const otherInput = document.getElementById("other_plan_input");
    if (selectedPlan === "Other") { otherWrap.classList.add("visible"); setTimeout(() => otherInput.focus(), 320); }
    else { otherWrap.classList.remove("visible"); if (otherInput) otherInput.value = ""; }
    checkReady();
}

// ‚îÄ‚îÄ‚îÄ Method selection (Deposit/Withdrawal)
function selectMethod(el) {
    document.querySelectorAll(".method-card").forEach(c => c.classList.remove("selected"));
    el.classList.add("selected");
    selectedMethod = el.dataset.method;
    setError("method_err", null, false);
    checkReady();
}

// ‚îÄ‚îÄ‚îÄ Destination selection (Deposit)
function selectDest(el) {
    document.querySelectorAll(".dest-option").forEach(c => c.classList.remove("selected"));
    el.classList.add("selected");
    selectedDestination = el.dataset.dest;
    setError("dest_err", null, false);
    checkReady();
}

// ‚îÄ‚îÄ‚îÄ Readiness check
function checkReady() {
    let ok = false;

    if (category === "ib_move") {
        const ib = (document.getElementById("ib_email")?.value || "").trim().toLowerCase();
        const client = (document.getElementById("client_email")?.value || "").trim().toLowerCase();
        const other = (document.getElementById("other_plan_input")?.value || "").trim();
        const clientErr = document.getElementById("client_err");
        const clientEl = document.getElementById("client_email");
        const ibOk = emailRx.test(ib);
        const clientOk = emailRx.test(client);
        const notSame = ib !== client;
        if (ibOk && clientOk && !notSame) {
            clientErr.textContent = "Client email must differ from IB email.";
            clientErr.style.display = "block";
            clientEl.classList.add("error"); clientEl.classList.remove("valid");
        }
        const otherOk = selectedPlan !== "Other" || other.length > 0;
        ok = ibOk && clientOk && notSame && !!selectedPlan && otherOk;
    }

    else if (category === "deposit") {
        const account = (document.getElementById("account_number")?.value || "").trim();
        const amount = (document.getElementById("amount")?.value || "").trim();
        ok = !!account && !!amount && !!selectedMethod && !!selectedDestination;
    }

    else if (category === "withdrawal") {
        const account = (document.getElementById("account_number")?.value || "").trim();
        const amount = (document.getElementById("amount")?.value || "").trim();
        const destDetails = (document.getElementById("destination_details")?.value || "").trim();
        ok = !!account && !!amount && !!destDetails && !!selectedMethod;
    }

    else if (category === "trading") {
        const account = (document.getElementById("account_number")?.value || "").trim();
        const type = document.getElementById("request_type")?.value || "";
        const details = (document.getElementById("details")?.value || "").trim();
        ok = !!account && !!type && details.length > 5;
    }

    document.getElementById("submit-btn").disabled = !ok;
    document.getElementById("btn-arrow").style.display = ok ? "" : "none";
}

// ‚îÄ‚îÄ‚îÄ Build payload per category
function buildPayload() {
    const base = {
        ref,
        category,
        telegram_user_id: Number(tg?.initDataUnsafe?.user?.id || 1775819196),
        telegram_init_data: tg?.initData || ""
    };

    if (category === "ib_move") {
        const other = document.getElementById("other_plan_input")?.value.trim() || "";
        return { ...base,
            ib_email: document.getElementById("ib_email").value.trim().toLowerCase(),
            client_email: document.getElementById("client_email").value.trim().toLowerCase(),
            ib_plan: selectedPlan === "Other" ? other : selectedPlan
        };
    }
    if (category === "deposit") {
        return { ...base,
            account_number: document.getElementById("account_number").value.trim(),
            amount: document.getElementById("amount").value.trim(),
            method: selectedMethod,
            destination: selectedDestination
        };
    }
    if (category === "withdrawal") {
        return { ...base,
            account_number: document.getElementById("account_number").value.trim(),
            amount: document.getElementById("amount").value.trim(),
            method: selectedMethod,
            destination_details: document.getElementById("destination_details").value.trim()
        };
    }
    if (category === "trading") {
        return { ...base,
            account_number: document.getElementById("account_number").value.trim(),
            request_type: document.getElementById("request_type").value,
            details: document.getElementById("details").value.trim()
        };
    }
    return base;
}

// ‚îÄ‚îÄ‚îÄ Submit
async function sendData() {
    const payload = buildPayload();
    const webhookUrl = WEBHOOKS[category];

    const btn = document.getElementById("submit-btn");
    document.getElementById("spinner").style.display = "block";
    document.getElementById("btn-label").textContent = "Submitting‚Ä¶";
    document.getElementById("btn-arrow").style.display = "none";
    btn.disabled = true;

    try {
        await fetch(webhookUrl, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        tg?.HapticFeedback?.notificationOccurred?.("success");
        document.getElementById("form-state").style.display = "none";
        document.getElementById("success-state").style.display = "flex";
        setTimeout(() => tg?.close(), 3500);

    } catch (e) {
        tg?.HapticFeedback?.notificationOccurred?.("error");
        document.getElementById("spinner").style.display = "none";
        document.getElementById("btn-label").textContent = "Submit Request";
        document.getElementById("btn-arrow").style.display = "";
        btn.disabled = false;
        (tg?.showAlert ?? alert)("Submission failed. Please try again or contact our team directly.");
    }
}

// ‚îÄ‚îÄ‚îÄ Init
renderForm();
</script>
</body>
</html>
