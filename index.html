<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IB Move Request</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            padding: 20px;
            margin: 0;
        }
        h2 { margin-top: 0; color: var(--tg-theme-text-color); }
        label { display: block; margin-top: 15px; font-weight: bold; font-size: 14px;}
        input, select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid var(--tg-theme-hint-color, #ccc);
            border-radius: 8px;
            background-color: var(--tg-theme-secondary-bg-color, #f4f4f5);
            color: var(--tg-theme-text-color, #000);
            box-sizing: border-box;
            font-size: 16px;
        }
    </style>
</head>
<body>

    <h2>ðŸ”„ IB Move Request</h2>
    <p>Please enter the details for the client move.</p>

    <label for="client_email">Client Email</label>
    <input type="email" id="client_email" placeholder="client@example.com">

    <label for="ib_email">IB Email</label>
    <input type="email" id="ib_email" placeholder="ib@example.com">

    <label for="ib_plan">Select IB Plan</label>
    <select id="ib_plan">
        <option value="The Stoa Apex">The Stoa Apex</option>
        <option value="The Kleos">The Kleos</option>
        <option value="The Acropolis">The Acropolis</option>
    </select>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        tg.MainButton.setText("Submit IB Move");
        tg.MainButton.show();

        Telegram.WebApp.onEvent('mainButtonClicked', function() {
            const clientEmail = document.getElementById('client_email').value;
            const ibEmail = document.getElementById('ib_email').value;
            const ibPlan = document.getElementById('ib_plan').value;

            if (!clientEmail || !ibEmail) {
                tg.showAlert("Please fill out both email fields.");
                return;
            }

            tg.MainButton.showProgress();

            const data = {
                client_email: clientEmail,
                ib_email: ibEmail,
                ib_plan: ibPlan,
                telegram_user_id: tg.initDataUnsafe?.user?.id
            };

            fetch('https://stoicfx.app.n8n.cloud/webhook/3a667794-774f-4538-8faa-6219f3aa43b2', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => {
                tg.close();
            })
            .catch(error => {
                tg.MainButton.hideProgress();
                tg.showAlert("Error submitting. Please try again.");
            });
        });
    </script>
</body>
</html>

